<video class="mtbva-video"
       width="100%"
       loop="true"
       controls="controls">
  <source
    src="/content/images/videos/"
    type="video/mp4">
  Your browser does not support the video tag.
</video>
<iframe class="mtbva-youtube"
        frameborder="0"
        allowfullscreen
        src="">
</iframe>
<div id="rockstar"
     class="ride-with-gps-switcher">
  <div class="route-selection">
    <button data-route=trail">Trail</button>
    <button data-route="gravel">Gravel</button>
    <button data-route="pave">Pave</button>
  </div>
  <iframe src="https://rwgps-embeds.com/embeds?type=route&id=27086614&sampleGraph=true"
          data-route="trail"></iframe>
</div>
<script>
$(function($) {
  var id = "rockstar"
  var routes = [
    {
      name: "trail",
      url: "https://rwgps-embeds.com/embeds?type=route&id=27086614&sampleGraph=true"
    },
    {
      name: "gravel",
      url: "https://rwgps-embeds.com/embeds?type=route&id=27056025&sampleGraph=true"
    },
    {
      name: "pave",
      url: "https://rwgps-embeds.com/embeds?type=route&id=27086777&sampleGraph=true"
    }
  ]

  if (!window.rideWithGps) {
    window.rideWithGps = {}
  }
  window.rideWithGps[id] = routes[0]
  $("#" + id + " button")
    .each(function(i, button) {
      $(button).click(function() {
        var buttonRoute = $(button).attr("data-route")
        if (window.rideWithGps[id] === buttonRoute) {
          return
        }

        $("#" + id + " iframe").css("visibility", "hidden")

        var attachedIframe
        $("#" + id + " iframe").toArray().forEach(function(iframe) {
          if ($(iframe).attr("data-route") === buttonRoute) {
            attachedIframe = iframe
            return
          }
        })
        if (attachedIframe) {
          // iframe is already in the DOM
          $(attachedIframe)
            .css("display", "block")
            .css("visibility", "visible")
        } else {
          // load new iframe into the DOM
          var routeToLoad
          routes.forEach(function(route) {
            if (route.name === buttonRoute) {
              routeToLoad = route
              return
            }
          })
          $("#" + id).append(
            $("<iframe>")
              .attr("src", routeToLoad.url)
              .attr("data-route", routeToLoad.name)
          )
        }
        
        // update global object
        window.rideWithGps[id] = buttonRoute

        // hide all the other iframes
        $("#" + id + " iframe").each(function(i, iframe) {
          if ($(iframe).attr("data-route") !== buttonRoute) {
            $(iframe).css("display", "none")
          }
        })
      })
    })
})
</script>